<div id = "slider-main">
    [[w:SliderWidget|slider_id=1;]]
</div>

<!--<div id="slider-fon"></div>-->

<div id="slider-form">
	<!--<div class="inner">
		<h4>Путешествуйте вместе с нами!</h4>
		<h3>Найдите свое идеальное путешествие</h3>

		<ul class="nav nav-tabs">
			<li class="active"><a href="#tyrs" data-toggle="tab">Туры</a></li>
			<li><a href="#avia" data-toggle="tab">Авиабилеты</a></li>
			<li><a href="#otels" data-toggle="tab">Отели</a></li>
			<a href = "" class="gift">Подарочные карты</a>
		</ul>
		<div class="tab-content">
			<div class="tab-pane active" id = "tyrs">
				<div class="row">
					<form action = "" id = "tyrs-form">
						<div class="col-xs-6">
							<div class="form-group">
								<label for = "country_to">Куда хотите поехать</label>
								<select type = "text" name = "country_to" placeholder = "Выберите страну" class="form-control">
									<option value = "Выберите страну">Выберите страну</option>
									<option value = "Россия">Россия</option>
									<option value = "Беларусь">Беларусь</option>
								</select>
							</div>
							<div class="form-group">
								<label for = "country_from">Город вылета</label>
								<select type = "text" name = "country_from" placeholder = "Выберите страну" class="form-control">
									<option value = "Выберите город вылета">Выберите город вылета</option>
									<option value = "Россия">Россия</option>
									<option value = "Беларусь">Беларусь</option>
								</select>
							</div>
							<div class="form-group">
								<label for = "date">Дата вылета</label>
								<input type = "text" name = "date" placeholder = "01.01.2015" class="form-control" id="date_tyrs">
							</div>
							<a href = "">Расширеный поиск</a>
						</div>

						<div class="col-xs-4">
							<div class="row">
								<div class="col-xs-6">
									<div class="form-group">
										<label for = "kids">Дети</label>
										<select type = "text" name = "kids" placeholder = "1" class="form-control">
											<option value = "1">1</option>
											<option value = "2">2</option>
											<option value = "3">3</option>
										</select>
									</div>
								</div>

								<div class="col-xs-6">
									<div class="form-group">
										<label for = "parent">Взрослые</label>
										<select type = "text" name = "parent" placeholder = "1" class="form-control">
											<option value = "1">1</option>
											<option value = "2">2</option>
											<option value = "3">3</option>
										</select>
									</div>
								</div>

								<label for = "time" class="pad_left">Продолжительность</label>

								<div class="col-xs-6">
									<div class="form-group">
										<select type = "text" name = "time_to" placeholder = "1" class="form-control">
											<option value = "1">1</option>
											<option value = "2">2</option>
											<option value = "3">3</option>
										</select>
									</div>
								</div>

								<div class="col-xs-6">
									<div class="form-group">
										<select type = "text" name = "time_from" placeholder = "1" class="form-control">
											<option value = "1">1</option>
											<option value = "2">2</option>
											<option value = "3">3</option>
										</select>
									</div>
									<span>Ночей</span>
								</div>

								<div class="col-xs-6">
									<button type="submit">Подобрать</button>
								</div>

							</div>
						</div>
					</form>
				</div>
			</div>
			<div class="tab-pane" id="avia">
				<div class="row">
					<form action = "" id = "avia-form">
						<div class="col-xs-6">
							<div class="form-group">
								<label for = "city_to">Город вылета</label>
								<select type = "text" name = "city_to" placeholder = "Выберите город" class="form-control">
									<option value = "Выберите город">Выберите город</option>
									<option value = "Россия">Минск</option>
									<option value = "Беларусь">Москва</option>
								</select>
							</div>
							<div class="form-group">
								<label for = "date">Дата вылета</label>
								<input type = "text" name = "date" placeholder = "01.01.2015" class="form-control" id="date_avia">
							</div>
							<div class="form-group">
								<label for = "aviacompany">Авиакомпания</label>
								<select type = "text" name = "aviacompany" placeholder = "Любая авиакомпания" class="form-control">
									<option value = "Любая авиакомпания">Любая авиакомпания</option>
									<option value = "Авиакомпания 1">Авиакомпания 1</option>
									<option value = "Авиакомпания 2">Авиакомпания 2</option>
								</select>
							</div>
							<a href = "">Расширеный поиск</a>
						</div>

						<div class="col-xs-6">
							<div class="form-group">
								<label for = "holiday">Куда хотите поехать</label>
								<select type = "text" name = "holiday" placeholder = "Выберите страну" class="form-control">
									<option value = "Выберите страну">Выберите страну</option>
									<option value = "Египет">Египет</option>
									<option value = "Турция">Турция</option>
								</select>
							</div>

							<div class="form-group">
								<label for = "for">Для кого</label>
								<select type = "text" name = "for" placeholder = "1 взрослый" class="form-control">
									<option value = "1 взрослый">1 взрослый</option>
									<option value = "2 взрослых">2 взрослых</option>
									<option value = "3 взрослых">3 взрослых</option>
								</select>
							</div>
							<div class="col-xs-6">
								<div class="row">
									<button type="submit">Подобрать</button>
								</div>
							</div>
						</div>
					</form>
				</div>
			</div>
			<div class="tab-pane" id="popular">
			</div>
		</div>
	</div>-->
</div>

<div class = "redirect container">
    <div class="row">
        <h3 class="redirect_h3">Отели и страны <a href = "<?php echo $this->getUrlById(Yii::app()->params['pages']['strany-i-oteli']) ;?>" class = "show_all">Показать всё</a></h3>
    </div>
</div>

<div id = "slider-hotels">
    <div class = "container">
        <div id="slider-nav">
<?php
            $cookies = Yii::app()->getRequest()->getCookies();

            $cookie = $cookies->itemAt('PHPSESSID');

            if ($cookie != FALSE)
            {
                $cookie->expire = time() + 3600 * 24 * 7;

                $cookies->add('PHPSESSID', $cookie);
            }

            if(isset($categories))
            {
                foreach($categories as $key =>$category)
                {
                    $products = CatalogProducts::model()->active()->findAll('parent_id = :id', array('id' => $category->id));
                    if(!$products)
                    {
                        continue;
                    }
                    $images = $category->getFiles();
                    $flag = next($images);
                    $gerb = next($images);

                    echo '<div><img src = "'.$gerb['path'].'/small/'.$gerb['name'].'" alt = "'.$category['title'].'">'.$category['title'].'</div>';
                }
            }
?>
        </div>

        <div id="slider-for">
<?php
            if(isset($categories))
            {
                foreach($categories as $category)
                {
                    $products = CatalogProducts::model()->active()->findAll('parent_id = :id', array('id' => $category->id));

                    if($products)
                    {
                        echo
                        '<div class="item">';

                            for($i = 0, $count = count($products); $i < $count; $i += 2)
                            {
                                if($i == 4)
                                {
                                    break;
                                }
                                if($i <= $count)
                                {
                                    $images = $products[$i]->getOneFile('big');

                                    $stars = $products[$i]->getStars();

                                    $sostav = $products[$i]->getSostav();
                                    $dlitelnost = $products[$i]->getDlitelnost();

                                    echo
                                    '<div class="items-inner">
                                        <div class="col-xs-6 no-left">
                                            <div class="med-container">
                                                <img class="med" src = "'.$images.'" alt = "'.$products[$i]['title'].'">
                                                <div class="med-caption caption">
                                                    <h2>'.$products[$i]['title'].'</h2>
                                                    <div class="stars">';

                                                        for($j = 0; $j < 5; $j++)
                                                        {
                                                            if($j < $stars['value'])
                                                            {
                                                                echo '<img src = "/images/star_full.png" alt = "">';
                                                            }
                                                            elseif($j > 0)
                                                            {
                                                                echo '<img src = "/images/star.png" alt = "">';
                                                            }
                                                            else
                                                            {
                                                                break;
                                                            }
                                                        }
                                    $ico = ($products[$i]->price)
                                        ? '<i class=" icon '.$this->currency_usd->currencyName->icon.'"></i>'
                                        : '<i class=" icon '.$this->currency_eur->currencyName->icon.'"></i>';
                                    $price = ($products[$i]->price) ? $products[$i]->price * $this->currency_byn->course : $products[$i]->price_eur * $this->currency_byn->course * $this->currency_eur->course;
                                    $price_int = ($products[$i]->price) ? $products[$i]->price : $products[$i]->price_eur;

                                    echo
                                                    '</div>
                                                    <h3>От <span>'.number_format($price, 2, ".", " ").' руб.</span></h3>
                                                    <span class = "int-price">'.Yii::app()->format->formatNumber($price_int).$ico .'</span>
                                                    <div class="footer-container">
                                                        <span>'.$sostav['value'].'</span>
                                                        <span>'.$dlitelnost['value'].'</span>
                                                        <a class="forward" href = "'.$products[$i]->getUrlForItem($this->getUrlById(Yii::app()->params['pages']['strany-i-oteli'])).'">Перейти</a>
                                                    </div>
                                                </div>
                                            </div>
                                         </div>';
                                }

                                if($i + 1 < $count)
                                {
                                    $image = $products[$i + 1]->getOneFile('big');

                                    $stars = $products[$i + 1]->getStars();

                                    $sostav = $products[$i + 1]->getSostav();
                                    $dlitelnost = $products[$i + 1]->getDlitelnost();

                                    $ico = ($products[$i + 1]->price)
                                        ? '<i class=" icon '.$this->currency_usd->currencyName->icon.'"></i>'
                                        : '<i class=" icon '.$this->currency_eur->currencyName->icon.'"></i>';
                                    $price = ($products[$i + 1]->price) ? $products[$i + 1]->price * $this->currency_byn->course : $products[$i + 1]->price_eur * $this->currency_byn->course * $this->currency_eur->course;
                                    $price_int = ($products[$i + 1]->price) ? $products[$i + 1]->price : $products[$i + 1]->price_eur;

                                        echo
                                            '<div class="col-xs-6 no-right">
                                                <div class="med-container">
                                                    <img class="med" src = "'.$image.'" alt = "'.$products[$i + 1]['title'].'">
                                                    <div class="med-caption caption">
                                                        <h2>'.$products[$i + 1]['title'].'</h2>
                                                        <div class="stars">';

                                                            for($j = 0; $j < 5; $j++)
                                                            {
                                                                if($j < $stars['value'])
                                                                {
                                                                    echo '<img src = "/images/star_full.png" alt = "">';
                                                                }
                                                                elseif($j > 0)
                                                                {
                                                                    echo '<img src = "/images/star.png" alt = "">';
                                                                }
                                                                else
                                                                {
                                                                    break;
                                                                }
                                                            }
                                        echo
                                                        '</div>
                                                        <h3>От <span>'.number_format($price, 2, ".", " ").' руб.</span></h3>
                                                        <span class = "int-price">'.Yii::app()->format->formatNumber($price_int).$ico .'</span>
                                                        <div class="footer-container">
                                                            <span>'.$sostav['value'].'</span>
                                                            <span>'.$dlitelnost['value'].'</span>
                                                            <a class="forward" href = "'.$products[$i + 1]->getUrlForItem($this->getUrlById(Yii::app()->params['pages']['strany-i-oteli'])).'">Перейти</a>
                                                        </div>
                                                    </div>
                                                </div>
                                             </div>
                                        </div>';
                                }
                                else
                                {
                                    echo
                                    '</div>';
                                }
                            }
                        echo
                        '</div>';
                    }
                }
            }
?>
        </div>
    </div>
</div>

<div class="clearfix"></div>
<div class = "redirect container">
    <div class="row">
        <h3 class="redirect_h3">Тематические туры <a href = "<?php echo $this->getUrlById(Yii::app()->params['pages']['tema-tours']) ;?>" class = "show_all">Показать всё</a></h3>
    </div>
</div>

<div id="temat-tyrs">
    <div class="container">
        <div class="row">
            <div class="col-xs-5 no-right">
                <div class="row">
                    <ul class="nav nav-tabs">
<?php
                        if($tem_tours)
                        {
                            foreach($tem_tours as $key => $value)
                            {
                                $image = $value->getOneFile('medium');

                                if(!is_file($image))
                                {
                                    $image = $value->getOneFile('big');
                                }
                                $active = ($key == 0) ? 'active' : '';
                                echo
                                    '<li class="'.$active.'">
                                        <img src = "/'.$image.'" alt = "">
                                        <a href="#'.$value['name'].'" data-toggle="tab">
                                            '.$value['title'].'
                                        </a>
                                    </li>';

                                $description[$value->name] = $value->preview;
                                $title[$value->name] = $value->title;
                            }
                        }
?>
                    </ul>
                </div>
            </div>
            <div class="col-xs-7 no-right">
                <div class="tab-content">
<?php
                    if(isset($tem_products))
                    {
                        $count = 0;
                        foreach($tem_products as $key => $value)
                        {
                            $active = ($count == 0) ? 'active' : '';
                            $count++;

                            echo '<div class="tab-pane '.$active.'" id = "'.$key.'">';

                            echo
                                '<div class="row">
                                    <h3 class="temat_title">'.$title[$key].'</h3>
                                    <h4 class="col-xs-11 no-all">
                                        '.$description[$key].'
                                    </h4>
                                </div>';

                                foreach($value as $k => $v)
                                {
                                    $end = false;
                                    $image = $v->getOneFile('medium');

                                    if(!is_file($image))
                                    {
                                        $image = $v->getOneFile('big');
                                    }

                                    $stars = $v->getStars();

                                    $sostav = $v->getSostav();
                                    $dlitelnost = $v->getDlitelnost();

                                    if($k == 0 || $k == 3)
                                    {
                                        echo '<div class="col-xs-6 no-all">';
                                    }

                                    $link = $this->getUrlById(Yii::app()->params['pages']['strany-i-oteli']).'/'.$v->getUrlForItem(Yii::app()->params['strany_catalog'], false);

                                    echo
                                        '<a href="'.$link.'">
                                            <div class="item">
                                                <img src = "/'.$image.'" alt = "">
                                                <div class="caption">
                                                    <h3>'.$v->title.'</h3>
                                                    <div class="stars">';
                                                        for($i = 0; $i < 5; $i++)
                                                        {
                                                            if($i < $stars['value'])
                                                            {
                                                                echo '<img src = "/images/star_full.png" alt = "">';
                                                            }
                                                            elseif($i > 0)
                                                            {
                                                                echo '<img src = "/images/star.png" alt = "">';
                                                            }
                                                            else
                                                            {
                                                                break;
                                                            }
                                                        }

                                    $ico = ($v->price)
                                        ? '<i class=" icon '.$this->currency_usd->currencyName->icon.'"></i>'
                                        : '<i class=" icon '.$this->currency_eur->currencyName->icon.'"></i>';
                                    $price = ($v->price) ? $v->price * $this->currency_byn->course : $v->price_eur * $this->currency_byn->course * $this->currency_eur->course;
                                    $price_int = ($v->price) ? $v->price : $v->price_eur;

                                    echo
                                                    '</div>
                                                    <h5>От <span>'.number_format($price, 2, ".", " ").' руб.</span></h5>
                                                    <span class = "int-price">'. Yii::app()->format->formatNumber($price_int).$ico .'</span>
                                                    <div class="footer-container">
                                                        <span>'.$sostav->value.'</span>
                                                        <span>'.$dlitelnost->value.'</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </a>';

                                    if($k == 2 || $k == 5)
                                    {
                                        $end = true;
                                        echo '</div>';
                                    }
                                }
                            echo '</div>';

                            if(isset($end) && !$end)
                            {
                                echo '</div>';
                                unset($end);
                            }
                        }
                    }
?>
                </div>
            </div>
        </div>
    </div>
</div>

<div class = "redirect gray">
    <div class="container">
        <div class="row">
            <div class="col-xs-11 no-all">
                <?php echo $this->text ;?>
            </div>
        </div>
    </div>
</div>

<?php
    if(isset($fresh) && !empty($fresh))
    {
?>
        <div class = "redirect container">
            <div class="row">
                <h3 class="redirect_h3">Свежие туры <a href = "" class = "show_all">Показать всё</a></h3>
            </div>
        </div>

        <div id="fresh-tyr">
            <div class="container no-all">
                <div class="row">
                    <div id="slider_fresh">
<?php
                    $end = false;
                    $parent_id = 0;
                    foreach($fresh as $value)
                    {
                        if($parent_id != $value->parent_id)
                        {
                            $parent_id = $value->parent_id;

                            if($end && $kol < 3)
                            {
                                echo
                                                '</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>';
                            }

                            $kol = 0;

                            $parent = CatalogTree::model()->active()->find('id = :id', array('id' => $value->parent_id));

                            $image = $parent->getOneFile('medium');

                            if(!is_file($image))
                            {
                                $image = $parent->getOneFile('big');
                            }

                            $stars = $value->getStars();

                            $count = CatalogProducts::model()->active()->count('parent_id = :id', array('id' => $parent->id));
                        }

                        $tour_img = $value->getOneFile('small');

                        if(isset($kol) && $kol > 2)
                        {
                            continue;
                        }

                        if($kol == 0)
                        {
                            $end = true;
                            $link = $this->getUrlById(Yii::app()->params['pages']['strany-i-oteli']).'/'.$parent->name;

                            echo
                                '<div class="item">
                                    <img src = "/'.$image.'" alt = "">
                                    <h2>'.$parent->title.'</h2>
                                    <a href = "/'.$link.'" class="fresh_counts">'.$count.' '. Yii::t('app', 'Tours', $count).'</a>
                                    <div class="slider_fresh_for">
                                    <div class="row">
                                        <div class="items">
                                            <div class="item">';
                        }
                                            echo
                                                '<a href="'.$link.'/'.$value->name.'" class="inner_cont">
                                                    <div class="inner">
                                                        <h5 class="title">'.$value->title.'</h5>
                                                        <img src = "/'.$tour_img.'" alt = "">
                                                        <div class="clearfix"></div>
                                                        <div class="stars">';

                                                            for($i = 0; $i < 5; $i++)
                                                            {
                                                                if($i < $stars['value'])
                                                                {
                                                                    echo '<img src = "/images/star_full.png" alt = "">';
                                                                }
                                                                elseif($i > 0)
                                                                {
                                                                    echo '<img src = "/images/star.png" alt = "">';
                                                                }
                                                                else
                                                                {
                                                                    break;
                                                                }
                                                            }

                                            $price = ($value->price) ? $value->price * $this->currency_byn->course : $value->price_eur * $this->currency_byn->course * $this->currency_eur->course;
                                            $price = ($value->price) ? $value->price * $this->currency_byn->course : $value->price_eur * $this->currency_byn->course * $this->currency_eur->course;
                                            $price_int = ($value->price) ? $value->price : $value->price_eur;

                                            echo
                                                        '</div>
                                                        <h5>От <span>'.number_format($price, 2, ".", " ").' руб.</span></h5>
                                                        <span class = "int-price" style="font-size: 14px; margin-top: -5px;">'.Yii::app()->format->formatNumber($price_int).$ico.'</span>
                                                    </div>
                                                </a>';

                                                $kol++;

                        if($kol % 3 == 0 && $kol < 4)
                        {
                            echo
                                            '</div>
                                        </div>
                                    </div>
                                </div>
                            </div>';
                        }
                    }
                    if($kol % 3 != 0)
                    {
                        echo
                                        '</div>
                                    </div>
                                </div>
                            </div>
                        </div>';
                    }
?>
            </div>
        </div>
    </div>
</div>

<?php
    }
?>

<div id="news-main">
    <div class="container no-all">
        <div class="row">
            <div class="col-xs-6 bron">
                <h3>Раннее бронирование</h3>
                [[w:BlockWidget|block_id=1;]]
<?php
                $model = new BronForm();

                $form = $this->beginWidget('BsActiveForm',
                    array(
                        'id' => 'form-bron',
                        'htmlOptions' => array(
                            'role' => 'form',
                            'class' => 'poland'
                        ),
                        'enableAjaxValidation' => false,
                        'enableClientValidation' => true,
                        'clientOptions' => array(
                            'validateOnSubmit' => true,
                            'validateOnChange' => true,
                            'validateOnType' => false,
                        ),
                    )
                );
?>
                <div class = "form-group">
                    <?php echo $form->label($model, 'country', array('label' => Yii::t('app', 'Where you want to go'))); ?>
                    <?php echo $form->dropDownList($model, 'country', CatalogTree::getCountry(), array('empty' => Yii::t('app', 'Choose the country'))); ?>
                    <?php echo $form->error($model, 'country'); ?>
                </div>

                <div class = "form-group">
                    <?php echo $form->label($model, 'name'); ?>
                    <?php echo $form->textField($model, 'name', array('placeholder' => 'Иванов Иван')); ?>
                    <?php echo $form->error($model, 'name'); ?>
                </div>

                <div class = "form-group">
<?php
                    echo $form->label($model, 'phone');

                    $this->widget('CMaskedTextField',
                        array(
                            'model' => $model,
                            'attribute' => 'phone',
                            'mask' => Yii::app()->params['phone']['mask'],
                            'htmlOptions' => array(
                                'placeholder' => $model->getAttributeLabel('phone'),
                                'class' => 'form-control',
                            )
                        )
                    );
                    echo $form->error($model, 'phone');
?>
                </div>

                <div class = "form-group">
                    <?php echo $form->label($model, 'email'); ?>
                    <?php echo $form->textField($model, 'email', array('placeholder' => 'ivanov@gmail.com')); ?>
                    <?php echo $form->error($model, 'email'); ?>
                </div>

                <div class = "form-group">
                    <?php echo $form->label($model, 'questions'); ?>
                    <?php echo $form->textarea($model, 'questions', array('placeholder' => 'Оставьте свой комментарий...')); ?>
                    <?php echo $form->error($model, 'questions'); ?>
                </div>

                <div class="clearfix"></div>
<?php
                echo BsHtml::submitButton(Yii::t('app', 'Book'), array('id' => 'viz_submit'));
                $this->endWidget();
?>
            </div>
            <div class="col-xs-6 news">
                <h3>Новости</h3>
                [[w:NewsLastWidget|count=4;parent_id=2;view=main;]]

                <a href = "<?php echo $this->getUrlById(Yii::app()->params['pages']['novosti']) ;?>" class="all_items">Все новости</a>
                <div id="send">
                    <input type = "text" placeholder="Ваш email"><a href = "" class = "show_all">Подписаться</a>
                </div>
            </div>
        </div>
    </div>
</div>

<?php
    $cs = Yii::app()->getClientScript();

    $slider = '
        $("#slider-for").slick(
        {
            slidesToShow: 1,
            slidesToScroll: 1,
            arrows: false,
            fade: true,
            asNavFor: "#slider-nav"
        });

        $("#slider-for .item").slick(
        {
            slidesToShow: 1,
            slidesToScroll: 1,
            arrows: false,
            fade: true,
            dots: true,
            autoplay: true,
            autoplaySpeed: 5000,
        });

        $("#slider-nav").slick({
            slidesToShow: 7,
            variableWidth: true,
            slidesToScroll: 1,
            asNavFor: "#slider-for",
            dots: false,
            centerMode: false,
            focusOnSelect: true
        });

        $("#slider_fresh").slick({
			slidesToShow: 3,
			slidesToScroll: 1,
			dots: false,
			centerMode: false,
		});
    ';

    $cs->registerScript('slider', $slider);
?>
